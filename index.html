<!doctype html>

<!-- Ting Yin. Created on... Updated on... -->
<!-- https:/...-->

<!-- Colours: (very pretty light red but not used #ffb2bf)
  - red: lighest pink (#ffced9), light pink (#ffc1cf), bright red (#d10000), dark red (#75000b)
  - yellow: very light yellow (#fffdef)
  - blue: blue (#0081dd), navy (#00267a), dark blue (#00194f)
-->

<html lang = "en-US">
<head>
  <title>Pears : twyin</title>

  <meta charset = "UTF-8">

  <script src="web_version/JS/Board.js"></script>
  <script src="web_version/JS/GameBoard.js"></script>
  <script src="web_version/JS/PathsBoard.js"></script>
  <script src="web_version/JS/Pears.js"></script>
  <script src="web_version/JS/PLevel.js"></script>

  <!--  <script>GameBoard.minTurns();</script>  -->
  <link href="https://fonts.googleapis.com/css?family=Coming+Soon" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css?family=Comfortaa" rel="stylesheet">

<link href="https://fonts.googleapis.com/css?family=Poiret+One" rel="stylesheet">



  <style>

  :root {
  	--cell-size: 32px;
  	--emphasis--color: #efa2b4;
  }

  body {
    background-color: #ffc1cf;
    color: #ffffff;
    margin: 0px 10px 300px 20px; 
    /* large bottom margin willallow user to scroll up a bit*/
    /*score and timer will be shown on the top of the page still*/
  }

  button {
    background-color: Transparent;
    background-repeat: no-repeat;
    border: none;
    cursor: pointer;
    overflow: hidden;
    outline: none;
  }

  button:active {
    color: red;
    background-color: #ffffff;
  }


  p.start_msg {
    /*font-family: 'Coming Soon', cursive;*/

    font-family: 'Poiret One', sans-serif;

    font-weight: 600;

    text-shadow: 0.5px 0.5px #900;

  	font-size: 24px;
    /*width: 50%;*/
    min-width: 300px;
    max-width: 70%;
    /*line-height: 120%;*/
  }

  p.topScore {
    font-family: 'Comfortaa', sans-serif;
    font-size: 110%;
    font-weight: 700;
    text-shadow: 0.5px 0.5px #900;

    position: fixed;
    top: 0;
    width: 30%;
    max-width: 300px;
    background-color: #ffced9;
    overflow: hidden;

    padding:10px;

  }

  p.topTimer {
    font-family: 'Comfortaa', sans-serif;
    font-size: 110%;
    font-weight: 700;
    text-shadow: 0.5px 0.5px #900;

    position: fixed;
    top: 0;
    width: 20%;
    max-width: 250px;
    margin-left:300px;
    background-color: #ffced9;
    overflow: hidden;

    padding: 10px;
  }

  pre.title {
    font-size: 25px;
    text-shadow: 0.5px 0.5px #00194f;
  }

  div.board{
    /*width: 100%;*/
    /*border-spacing: 10px;*/
    border-collapse: collapse;
    border: #ffffff solid thin;

    font-family: 'Comfortaa', cursive;
    /*text-shadow: 0.5px 0.5px #000;*/

    /*font-family: 'Coming Soon', cursive;*/

    font-size: 16px;

    border-width: 1px;

    margin-right: 15px;
    padding: 5px;

/*    max-width: 700px;*/

    /*disable selection*/
    -webkit-touch-callout: none; /* iOS Safari */
    -webkit-user-select: none; /* Chrome, Safari, Opera */
     -khtml-user-select: none; /* Konqueror HTML */
       -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
         -o-user-select: none;
            user-select: none;
    display: inline-flex;
    flex-direction: column;
    flex-content: space-around;



  }

  div.cell {
    height: var(--cell-size);
    width: var(--cell-size);

    min-width: var(--cell-size);
    min-height: var(--cell-size);
    max-width: var(--cell-size);
    max-height: var(--cell-size);

    padding: 5px;
    /*border-collapse: collapse;*/
    border-width: 1px;
    border-radius: 7px;

    display: inline-flex;
    justify-content: center;
    align-items: center;

    margin: 5px 5px 5px 5px;


  }


  div.cell.cell--board {
    border: 10px #ffffff thin;
    border-collapse: collapse;
    border-style: dashed;
    


    
  }

  div.cell.cell--remove {
    text-align: center;
  /*  border: 10px #ffffff thin;*/
    border-color: #ffffff;
    border-collapse: collapse;
    border-style: none;
    padding: 6px;  /*necessary to account for the extra px*/

    color: #ffc1cf;

  }

  div.cell.cell--obstacle {
  	/*create appearance of small circles as obstacles, but is actually
  		filled square with round edges and a thick border with the
  		same color as background*/
  	padding: 0px;

  	border-width: 6px;
    border-color: #ffc1cf;
    border-style: solid;

    color: #ffaab9;
    background-color: #ffaab9;

    border-radius: 20px;

  }

  /* only be one element on the grid should be emphasized at a time */
  div.cell.cell--emphasis {
  	background-color: var(--emphasis--color);
  }


  div.cell.cell--board:hover {
    color: white;
    background-color: var(--emphasis--color);
    cursor: pointer;
  }

  div.cell.cell--obstacle:hover {
    /*color: #ffffff;
    background-color: #ffffff;*/

    pointer-events: none;  /* disable hover effects*/
  }


  div.row {

    /*border: 1px #ffffff thin;*/
    border-collapse: collapse;
    /*border-style: dashed;*/

    border-width: 1px;
/*  	height: var(--cell-size);
    width: var(--cell-size);
*/
/*    min-width: var(--cell-size);
    min-height: var(--cell-size);
    max-width: var(--cell-size);
    max-height: var(--cell-size);*/

    display: inline-flex;
    /*justify-content: space-around;*/

  }

  </style>
</head>
  
<body id="mainPage">

  <p class="topScore" id="score">Pears matched: </p>
  <p class="topTimer" id="timer">Time remaining: </p>

  <br><br><br>
  <pre class="title">Hello Pears &hearts;</pre>


</body>



<script>

	levelCounter = -1;
  //var currLevel = game[levelCounter];
  //var currGB = currLevel.gboard;

  var currLevel;
  var currGB;
  var height, width;
  var totalUnsolvedPairs;
	//window.onload = newLevel();
  newLevel();

  print_starter_msg();


//document.getElementById("score").innerHTML = "Score: " + currGB.getUnsolvedPairs();


  //var height = currLevel.gboard.getHeight();
  //var width = currLevel.gboard.getWidth();

  function newLevel() {
    // clear current table
    var boardElement = document.getElementById('gameboard');
    if (boardElement) {
      boardElement.parentNode.removeChild(boardElement);
      // must clear starting message if user finished level 1 before
      //   it's time for message to disappear
    }

    if (document.getElementById("starter_msg")) {
      document.getElementById("starter_msg").innerHTML = " ";
    }


    levelCounter++;
    currLevel = game[levelCounter];
    currGB = currLevel.gboard;

    totalUnsolvedPairs = currGB.getUnsolvedPairs();
    document.getElementById("score").innerHTML = "Pears matched: " + 
    	(totalUnsolvedPairs - currGB.getUnsolvedPairs()) + " / " + totalUnsolvedPairs;

    height = currLevel.gboard.getHeight();
    width = currLevel.gboard.getWidth();
    drawBoard();

  }


  function drawBoard() {
    //var body = document.getElementsByTagName('body')[0];

    var game = document.createElement("div");
    game.setAttribute("class", "board");
    game.setAttribute("id", "gameboard");
    game.setAttribute("alt", "Incompatible Browser?")

    for (var i=0; i<height; i++) {
      var row = document.createElement("div");
      row.setAttribute("class","row");

      for (var j=0; j<width; j++) {

        // create row square

        var td = document.createElement('div');
        td.setAttribute("class", "cell");


        var id = (i+"_"+j);
        td.setAttribute("id",id);

        //var rowElement = document.createTextNode(currLevel.gboard.getValue(i,j));
        //var rowElement = document.createTextNode();

        var rowElementInner = document.createElement('span');
        var rowElementInnerContent = 
        document.createTextNode(currLevel.gboard.getValue(i,j));
        rowElementInner.appendChild(rowElementInnerContent);
        td.appendChild(rowElementInner);

        // create button
// BUTTON MAY BE UNNECESSARY SINCE THE TABLE ELEMENTS CAN BE CLICKED ON!
        //var btn = document.createElement('button');
        //var rowButton = document.createTextNode(currLevel.gboard.getValue(i,j));
// ============ ultimately useless buttons

        //btn.addEventListener('click', addClick(i,j), false);
        //btn.setAttribute("onclick", addClick(i,j));
        //rowButton.outerHTML = "<input type=\"button\" onclick=\"addClick(`i`,`j`)\"";

        //btn.setAttribute("onclick", `addClick(${i},${j})`); // i=y coord, j=x coord

        if (currLevel.gboard.getValue(i,j) == -1) {
          td.classList.add('cell--obstacle');
          // maybe setting to x is unnecessary
          //rowElement = document.createTextNode(" ");
        } else {
        	td.classList.add('cell--board');
          td.setAttribute("onclick", `addClick(${i},${j})`);
        }
        






// button related
        //btn.appendChild(rowButton);
        // add button to row element
        //td.appendChild(btn);
// button




        //addClick(i,j);

        //rowElement.addEventListener('click', addClick(i,j), false);


        //td.appendChild(rowElement);
        row.appendChild(td);

      }
      game.appendChild(row);
      
    }
   
    document.body.appendChild(game);

    //btn.addEventListener('click', addClick(i,j), false);


  }

  function print_starter_msg() {
    var msg = document.createElement('p');
    msg.setAttribute("id", "starter_msg");
    msg.setAttribute("class", "start_msg");

    var linebreak = document.createElement('br');
    msg.appendChild(linebreak);
    var message = document.createTextNode("S T O R Y \u00A0L I N E");
    // msg.setAttribute("class", "start_msg_title");
    msg.appendChild(message);
    var linebreak = document.createElement('br');
    msg.appendChild(linebreak);

    message = document.createTextNode("Once upon a time in the " +
      "land of fruits, there was a dance where " + 
      "pears from many tribes attended. The dance lasted hours " + 
      "and hours, until eventually, it was time to go home. " + 
      "But to do so, they must venture through a dark forest where " + 
      "the big, bad wolf resides! The evil wolf tends to attack "+ 
      "only when his prey is alone, so this is where YOU come in. " + 
      "Please show each fruit the path to another of its kind.");
    msg.appendChild(message);
    linebreak = document.createElement('br');
    msg.appendChild(linebreak);
    linebreak = document.createElement('br');
    msg.appendChild(linebreak);

    message = document.createTextNode("I N S T R U C T I O N S ");
    msg.appendChild(message);
    linebreak = document.createElement('br');
    msg.appendChild(linebreak);
    
    message = document.createTextNode("Each integer represents " + 
      "one species of pear. They can be paired up by " + 
      "using the mouse to click on the first integer, followed " +
      "by a mouse click on the second. You may hover over each " +
      "tile to see which will be selected if you were to click " + 
      "on it. You may travel outside of the board. A valid " + 
      "path on the grid must have the following: ");
    msg.appendChild(message);
    linebreak = document.createElement('br');
    msg.appendChild(linebreak);

    var ordered_list = document.createElement('ol');
    var list = document.createElement('li');
    var list_item = document.createTextNode("A path that does not " + 
      "travel through other integers or obstacles");
    list.appendChild(list_item);
    ordered_list.appendChild(list);

    list = document.createElement('li');
    list_item = document.createTextNode("A path that does needs 3 " + 
      "or less turns");
    list.appendChild(list_item);
    ordered_list.appendChild(list);

    list = document.createElement('li');
    list_item = document.createTextNode("An integer can only be " + 
      "matched with another integer with its equal value");
    list.appendChild(list_item);
    ordered_list.appendChild(list);

    msg.appendChild(ordered_list);

    message = document.createTextNode("H I N T");
    msg.appendChild(message);
    linebreak = document.createElement('br');
    msg.appendChild(linebreak);

    message = document.createTextNode("Start by matching " + 
      "pears that are horizontally or vertically next to each " + 
      "other. Then try to find pairs around the border.");
    msg.appendChild(message);
    linebreak = document.createElement('br');
    msg.appendChild(linebreak);

    document.body.appendChild(msg);

    // set to starter message to disappear after 4 minutes
    setTimeout(`clear_starter_msg()`, 240000);  

  }


  function clear_starter_msg() {
    document.getElementById("starter_msg").innerHTML = " ";
  }



  //var x1=null, y1=null, x2=null, y2=null; //(x1, y1) = coord of click 1, (x2, y2) = coord of click 2
  var x1=null, y1=null;

  function addClick(i,j) {

    if (x1==null && y1==null) {
      y1 = i;
      x1 = j;

      let element1 = document.getElementById(`${y1}_${x1}`);
      if (currGB.getValue(y1,x1)) {
        element1.classList.add('cell--emphasis');
      }
      console.log("yx: " + y1+","+x1);
    } else {
      console.log("ji: " + i+","+j);

      //match(++y1, ++x1, ++y2, ++x2);  //accomodate paths

      if (x1!=j || y1!=i) {
        match(y1, x1, i, j);

      }
      let element1 = document.getElementById(`${y1}_${x1}`);
     	element1.classList.remove('cell--emphasis');
      x1=null;
      y1=null;

    }

  }

  function match(y1, x1, y2, x2) {
    console.log("y1 x1 y2 x2: " + y1+" "+x1+" "+y2+" "+x2);

    //    console.log("To quit, enter -1");
//    console.log("Please enter coordinate separated by a space");
    let intA; // int
    let intB; // int
    let maxTurns = GameBoard.maxTurns; // int, should be 3


    intA = currGB.getValue(y1, x1);

    intB = currGB.getValue(y2, x2);
    
    if (intA!=intB || intA==0 || intB==0) {
      console.log("Invalid pear");
    } else {

      var i = currGB.minTurns(y1, x1, y2, x2);
      console.log("minTurns: " + i);
     
      if (i > maxTurns) {
        console.log("Invalid: must be within " + maxTurns + " turns");
      } else {
        // valid number of turns
        console.log("Valid: " + i + " turns needed ");
        currGB.setToZero(y1, x1);
        currGB.setToZero(y2, x2);
        //console.log(currGB.toString());

        let element1 = document.getElementById(`${y1}_${x1}`);

        element1.classList.remove('cell--board');
        element1.classList.add('cell--remove');

        //element1.textContent = "";

        let element2 = document.getElementById(`${y2}_${x2}`);
        element2.classList.remove('cell--board');
        element2.classList.add('cell--remove');
        //element2.textContent = "";

        updateScore();
      }
    }

  }


  function updateScore() {
    var pearsLeft = currGB.solvePair();
    document.getElementById("score").innerHTML = "Pears matched: " + 
    	(totalUnsolvedPairs - pearsLeft) + " / " + totalUnsolvedPairs;

    if (pearsLeft == 0) {
      //  will make level completion pop up more esthetically pleasing later
      endOfLevelAlert();
      newLevel();
    }

  }

  function endOfLevelAlert() {
  	alert("You've completed this level!");
  }

  


</script>


</html>





